# voice_assistant.py ç¨‹åºæµç¨‹å›¾

## 1. æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          VoiceAssistantWindow (ä¸»çª—å£)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                           PyQt6 GUI ç•Œé¢                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  ç”¨æˆ·è¾“å…¥åŒº   â”‚  â”‚    AIå›å¤åŒº       â”‚  â”‚  ğŸ¤ éº¦å…‹é£æŒ‰é’® / çŠ¶æ€æ˜¾ç¤º   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                        â”‚
â”‚                           WorkerSignals (ä¿¡å·é€šä¿¡)                            â”‚
â”‚                                      â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               â”‚                   â”‚                   â”‚                â”‚  â”‚
â”‚  â–¼               â–¼                   â–¼                   â–¼                â–¼  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ASRWorkerâ”‚  â”‚ChatWorkerâ”‚     â”‚TTSWorker  â”‚     â”‚Streaming  â”‚  â”‚Intent  â”‚  â”‚
â”‚ â”‚ (QThread)â”‚  â”‚ (QThread)â”‚     â”‚ (QThread) â”‚     â”‚TTSWorker  â”‚  â”‚Handler â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚      â”‚            â”‚                 â”‚                  â”‚             â”‚       â”‚
â”‚      â–¼            â–¼                 â–¼                  â–¼             â–¼       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚Audio    â”‚  â”‚Doubao   â”‚      â”‚Doubao     â”‚      â”‚Doubao     â”‚  â”‚Camera  â”‚  â”‚
â”‚ â”‚Recorder â”‚  â”‚Chat API â”‚      â”‚TTS API    â”‚      â”‚TTS API    â”‚  â”‚Utils   â”‚  â”‚
â”‚ â”‚(PyAudio)â”‚  â”‚(HTTP)   â”‚      â”‚(WebSocket)â”‚      â”‚(WebSocket)â”‚  â”‚        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        è¯†åˆ«æ¨¡å— (æœ¬åœ°å¤„ç†)                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚FaceRecognition  â”‚  â”‚ObjectDetector   â”‚  â”‚SpeakerRecognition      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚Manager          â”‚  â”‚(YOLOv8)         â”‚  â”‚Manager (Resemblyzer)   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚(face_recognition)â”‚  â”‚                 â”‚  â”‚                        â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        IntentHandler æ„å›¾ç±»å‹                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚SPEAKER_IDENTIFY   â”‚ â”‚SPEAKER_IDENTIFY â”‚ â”‚  LOOK    â”‚ â”‚ DEFAULT   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚_OTHER             â”‚ â”‚(å½“å‰è¯´è¯äºº)      â”‚ â”‚ çœ‹/æ‹ç…§  â”‚ â”‚ çº¯æ–‡æœ¬    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚(å¬å¬ä»–æ˜¯è°-ä¸¤è½®)   â”‚ â”‚                 â”‚ â”‚          â”‚ â”‚           â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ä¸»äº¤äº’æµç¨‹å›¾

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   ç¨‹åºå¯åŠ¨       â”‚
                              â”‚  main()         â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  VoiceAssistantWindow        â”‚
                        â”‚  __init__()                  â”‚
                        â”‚  - åˆå§‹åŒ–ä¿¡å· WorkerSignals   â”‚
                        â”‚  - åˆå§‹åŒ–äººè„¸è¯†åˆ«ç®¡ç†å™¨        â”‚
                        â”‚  - åˆå§‹åŒ–ç‰©ä½“æ£€æµ‹å™¨            â”‚
                        â”‚  - åˆå§‹åŒ–å£°çº¹è¯†åˆ«ç®¡ç†å™¨        â”‚
                        â”‚  - åˆå§‹åŒ–æ„å›¾å¤„ç†å™¨            â”‚
                        â”‚  - åˆå§‹åŒ–UIç•Œé¢               â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   ç­‰å¾…ç”¨æˆ·äº¤äº’   â”‚
                              â”‚  (äº‹ä»¶å¾ªç¯)      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                         ç”¨æˆ·ç‚¹å‡» ğŸ¤ éº¦å…‹é£æŒ‰é’®
                                       â”‚
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  _on_mic_button_clicked()    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                  â”‚                  â”‚
                    â–¼                  â–¼                  â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ is_tts_playingâ”‚  â”‚ is_recording  â”‚  â”‚    å¦åˆ™       â”‚
           â”‚   == True     â”‚  â”‚  == True      â”‚  â”‚  å¼€å§‹å½•éŸ³     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                  â”‚                  â”‚
                   â–¼                  â–¼                  â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚_interrupt_tts â”‚  â”‚_stop_recordingâ”‚  â”‚_start_recordingâ”‚
           â”‚ æ‰“æ–­æ’­æ”¾       â”‚  â”‚ åœæ­¢å½•éŸ³      â”‚  â”‚ å¼€å§‹å½•éŸ³      â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ å¯åŠ¨ ASRWorker      â”‚
                                              â”‚ (è¯­éŸ³è¯†åˆ«å·¥ä½œçº¿ç¨‹)   â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
                                                   (è§æµç¨‹3)
```

---

## 3. è¯­éŸ³è¯†åˆ«æµç¨‹ (ASRWorker)

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  ASRWorker.run()â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  å¯åŠ¨ AudioRecorder          â”‚
                        â”‚  å¼€å§‹ä»éº¦å…‹é£é‡‡é›†éŸ³é¢‘          â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  åå°çº¿ç¨‹: buffer_audio()    â”‚
                        â”‚  åœ¨WebSocketè¿æ¥å‰ç¼“å†²éŸ³é¢‘    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  å»ºç«‹ WebSocket è¿æ¥          â”‚
                        â”‚  wss://openspeech.bytedance  â”‚
                        â”‚  .com/api/v3/sauc/bigmodel   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  å‘é€åˆå§‹åŒ–è¯·æ±‚               â”‚
                        â”‚  _build_full_client_request  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                     â”‚
                    â–¼                                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  _send_audio()      â”‚              â”‚  _recv_result()     â”‚
         â”‚  å‘é€éŸ³é¢‘å¸§          â”‚              â”‚  æ¥æ”¶è¯†åˆ«ç»“æœ        â”‚
         â”‚  (å¹¶è¡Œä»»åŠ¡1)         â”‚              â”‚  (å¹¶è¡Œä»»åŠ¡2)         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                                    â”‚
                   â–¼                                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ 1. å‘é€ç¼“å†²åŒºéŸ³é¢‘    â”‚              â”‚ è§£æäºŒè¿›åˆ¶å“åº”       â”‚
         â”‚ 2. æŒç»­é‡‡é›†å¹¶å‘é€    â”‚              â”‚ _parse_response()   â”‚
         â”‚ 3. ç¼“å­˜éŸ³é¢‘åˆ°        â”‚              â”‚                     â”‚
         â”‚    audio_chunks     â”‚              â”‚ å‘å°„ä¿¡å·:            â”‚
         â”‚ 4. é™éŸ³æ£€æµ‹         â”‚              â”‚ asr_text_update     â”‚
         â”‚    (1.5ç§’è¶…æ—¶)      â”‚              â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                                    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  finally å—         â”‚
                        â”‚  1. å‘å°„ asr_audio  â”‚
                        â”‚     _data (åŸå§‹éŸ³é¢‘) â”‚
                        â”‚  2. å‘å°„ asr_       â”‚
                        â”‚     finished        â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. è¯­éŸ³è¯†åˆ«å®Œæˆåçš„å¤„ç†æµç¨‹

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  ä¿¡å·: asr_audio_data       â”‚
                        â”‚  ä¿¡å·: asr_finished         â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                     â”‚
                    â–¼                                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ _on_asr_audio_data  â”‚              â”‚ _on_asr_finished    â”‚
         â”‚ (å£°çº¹è¯†åˆ«å¤„ç†)       â”‚              â”‚ (ä¸»å¤„ç†æµç¨‹)         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                                    â”‚
                   â–¼                                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ waiting_for_speaker â”‚              â”‚ waiting_for_face    â”‚
         â”‚ _name == True?      â”‚              â”‚ _name == True?      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Yes             â”‚ No           â”‚ Yes        â”‚            â”‚
          â–¼                 â–¼              â–¼            â–¼            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚ è·³è¿‡åŒ¹é…  â”‚    â”‚æå–å£°çº¹     â”‚  â”‚_complete_faceâ”‚               â”‚
    â”‚ (ç­‰å¾…åå­—)â”‚    â”‚åŒ¹é…è¯´è¯äºº   â”‚  â”‚_registration â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                           â”‚                                         â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
                  â”‚                 â”‚                                â”‚
            åŒ¹é…æˆåŠŸ            æœªåŒ¹é…                               â”‚
                  â”‚                 â”‚                                â”‚
                  â–¼                 â–¼                                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
         â”‚current_speakerâ”‚ â”‚pending_speakerâ”‚                        â”‚
         â”‚_name = åå­—    â”‚ â”‚_embedding=å‘é‡ â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                                                                     â”‚
                                                                     â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ waiting_for_speaker_name     â”‚
                                              â”‚ == True?                     â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ Yes                          â”‚ No
                                              â–¼                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚_complete_speakerâ”‚          â”‚  æ„å›¾åˆ¤æ–­         â”‚
                                    â”‚_registration    â”‚          â”‚intent_handler    â”‚
                                    â”‚ æ³¨å†Œå£°çº¹         â”‚          â”‚.process()        â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                          â”‚
                                                                          â–¼
                                                                    (è§æµç¨‹5)
```

---

## 5. æ„å›¾å¤„ç†åˆ†æ”¯æµç¨‹

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  intent_handler.process â”‚
                                    â”‚  (æ„å›¾åˆ¤æ–­)              â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                        â”‚               â”‚               â”‚                    â”‚
       â–¼                        â–¼               â–¼               â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚SPEAKER_IDENTIFY  â”‚ â”‚SPEAKER_IDENTIFY â”‚ â”‚ LOOK        â”‚ â”‚ DEFAULT         â”‚ â”‚                 â”‚
â”‚_OTHER            â”‚ â”‚                 â”‚ â”‚             â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚ "å¬å¬ä»–æ˜¯è°"      â”‚ â”‚ "è¯†åˆ«å£°çº¹"       â”‚ â”‚ "çœ‹çœ‹"       â”‚ â”‚ çº¯æ–‡æœ¬å¯¹è¯       â”‚ â”‚                 â”‚
â”‚ "å¬å¬å¥¹æ˜¯è°"      â”‚ â”‚ "è°åœ¨è¯´è¯"       â”‚ â”‚ "è¿™æ˜¯ä»€ä¹ˆ"   â”‚ â”‚                 â”‚ â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                 â”‚
         â”‚                    â”‚                 â”‚                 â”‚          â”‚                 â”‚
         â–¼                    â–¼                 â–¼                 â–¼          â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                 â”‚
â”‚ä¸¤è½®å¯¹è¯æ¨¡å¼       â”‚ â”‚è¯†åˆ«å½“å‰è¯´è¯äºº    â”‚ â”‚æœ¬åœ°è¯†åˆ«      â”‚ â”‚  _call_chat()   â”‚ â”‚                 â”‚
â”‚                  â”‚ â”‚                 â”‚ â”‚             â”‚ â”‚  è°ƒç”¨ Chat API  â”‚ â”‚                 â”‚
â”‚ 1. è®¾ç½®ç­‰å¾…æ ‡å¿—   â”‚ â”‚ 1. è·å–éŸ³é¢‘æ•°æ®  â”‚ â”‚ 1. æ‹ç…§     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                 â”‚
â”‚ 2. è¿”å›æç¤ºè¯­     â”‚ â”‚ 2. æå–å£°çº¹ç‰¹å¾  â”‚ â”‚ 2. äººè„¸è¯†åˆ« â”‚          â”‚          â”‚                 â”‚
â”‚    "è¯·è®©ä»–è¯´è¯"   â”‚ â”‚ 3. åŒ¹é…å£°çº¹åº“    â”‚ â”‚ 3. YOLOæ£€æµ‹ â”‚          â”‚          â”‚                 â”‚
â”‚ 3. ä¸‹è½®è¯†åˆ«éŸ³é¢‘   â”‚ â”‚ 4. è¿”å›è¯†åˆ«ç»“æœ  â”‚ â”‚ 4. ç»“æœæ‹¼æ¥ â”‚          â”‚          â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚          â”‚                 â”‚
         â”‚                    â”‚                 â”‚                 â”‚          â”‚                 â”‚
         â–¼                    â–¼                 â”‚                 â”‚          â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                 â”‚          â”‚                 â”‚
â”‚waiting_for_other â”‚ â”‚ åŒ¹é…æˆåŠŸ?        â”‚        â”‚                 â”‚          â”‚                 â”‚
â”‚_speaker = True   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                 â”‚          â”‚                 â”‚
â”‚                  â”‚     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”            â”‚                 â”‚          â”‚                 â”‚
â”‚ ä¸‹ä¸€è½®å½•éŸ³æ—¶     â”‚ Yes â”‚         â”‚ No         â”‚                 â”‚          â”‚                 â”‚
â”‚ å¯¹éŸ³é¢‘è¿›è¡Œè¯†åˆ«   â”‚     â–¼         â–¼            â”‚                 â”‚          â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                 â”‚          â”‚                 â”‚
                     â”‚ è¿”å›åå­—  â”‚ â”‚ "æœªè¯†åˆ«"  â”‚  â”‚                 â”‚          â”‚                 â”‚
                     â”‚ å’Œç›¸ä¼¼åº¦  â”‚ â”‚ è¿”å›ç›¸ä¼¼åº¦â”‚  â”‚                 â”‚          â”‚                 â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                 â”‚          â”‚                 â”‚
                                                â”‚                 â”‚          â”‚                 â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                                                                  â”‚                            â”‚
                                                                  â–¼                            â”‚
                                                            (è§æµç¨‹6)                          â”‚
```

### æ„å›¾è§¦å‘å…³é”®è¯ä¸€è§ˆ

| æ„å›¾ç±»å‹ | å…³é”®è¯ç¤ºä¾‹ | å¤„ç†æ–¹å¼ |
|---------|-----------|---------|
| **SPEAKER_IDENTIFY_OTHER** | "å¬å¬ä»–æ˜¯è°"ã€"å¬å¬å¥¹æ˜¯è°"ã€"è®©ä»–è¯´å‡ å¥" | ä¸¤è½®å¯¹è¯ï¼šæç¤ºå¯¹æ–¹è¯´è¯â†’ä¸‹è½®å½•éŸ³â†’è¯†åˆ« |
| **SPEAKER_IDENTIFY** | "è¯†åˆ«å£°çº¹"ã€"è°åœ¨è¯´è¯"ã€"è¿™æ˜¯è°çš„å£°éŸ³" | å¯¹å½“å‰éŸ³é¢‘è¿›è¡Œå£°çº¹è¯†åˆ« |
| **LOOK** | "çœ‹çœ‹"ã€"çœ‹ä¸€ä¸‹"ã€"è¿™æ˜¯ä»€ä¹ˆ"ã€"æ‹ç…§" | æ‹ç…§â†’äººè„¸è¯†åˆ«+ç‰©ä½“æ£€æµ‹â†’æœ¬åœ°ç»“æœ |
| **DEFAULT** | å…¶ä»–æ‰€æœ‰æ–‡æœ¬ | ç›´æ¥è°ƒç”¨ Chat API |

### æ³¨æ„äº‹é¡¹

1. **å…³é”®è¯ä¼˜åŒ–**ï¼šç§»é™¤äº†å•å­—"çœ‹"ï¼Œé¿å…"è¯´è¯´çœ‹"ç­‰ä¹ æƒ¯ç”¨è¯­è¢«è¯¯åŒ¹é…
2. **ä¸¤è½®å¯¹è¯**ï¼šSPEAKER_IDENTIFY_OTHER æ„å›¾ä¼šè®¾ç½® `waiting_for_other_speaker=True`ï¼Œä¸‹ä¸€è½®å½•éŸ³ä¼šè‡ªåŠ¨è¿›è¡Œå£°çº¹è¯†åˆ«

---

## 6. Chatå¯¹è¯ä¸TTSæ’­æ”¾æµç¨‹

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  ChatWorker.run()       â”‚
                              â”‚  è°ƒç”¨ Doubao Chat API   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ å‘å°„ chat_thinking ä¿¡å· â”‚
                              â”‚ â†’ å¯åŠ¨ StreamingTTS     â”‚
                              â”‚   Worker (æµå¼TTS)      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  æµå¼æ¥æ”¶ Chat å“åº”      â”‚
                              â”‚  for chunk in response  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ æ¯ä¸ª chunk             â”‚
                              â–¼                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
                    â”‚ å‘å°„ chat_chunk ä¿¡å·â”‚           â”‚
                    â”‚ â†’ _on_chat_chunk()  â”‚           â”‚
                    â”‚   ç´¯ç§¯æ–‡æœ¬æ˜¾ç¤º       â”‚           â”‚
                    â”‚   ä¼ ç»™æµå¼TTSåˆæˆ    â”‚           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                              â”‚                        â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼ (æ‰€æœ‰chunkæ¥æ”¶å®Œæˆ)
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ å‘å°„ chat_reply ä¿¡å·    â”‚
                              â”‚ â†’ _on_chat_reply()      â”‚
                              â”‚   æ›´æ–°å¯¹è¯å†å²          â”‚
                              â”‚   é€šçŸ¥TTSæ–‡æœ¬ç»“æŸ       â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚          StreamingTTSWorker              â”‚
                   â”‚                                          â”‚
                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                   â”‚  â”‚ 1. æ¥æ”¶æ–‡æœ¬ç‰‡æ®µ (add_text_chunk)    â”‚ â”‚
                   â”‚  â”‚ 2. ç´¯ç§¯åˆ°ç¼“å†²åŒº                     â”‚ â”‚
                   â”‚  â”‚ 3. é‡åˆ°æ ‡ç‚¹ç¬¦å·è§¦å‘åˆæˆ             â”‚ â”‚
                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                   â”‚                  â”‚                       â”‚
                   â”‚                  â–¼                       â”‚
                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                   â”‚  â”‚ WebSocket è¿æ¥ TTS API              â”‚ â”‚
                   â”‚  â”‚ wss://openspeech.bytedance.com      â”‚ â”‚
                   â”‚  â”‚ /api/v3/tts/bidirection             â”‚ â”‚
                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                   â”‚                  â”‚                       â”‚
                   â”‚                  â–¼                       â”‚
                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                   â”‚  â”‚ æ¥æ”¶éŸ³é¢‘ç‰‡æ®µ â†’ audio_queue          â”‚ â”‚
                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                   â”‚                  â”‚                       â”‚
                   â”‚                  â–¼                       â”‚
                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                   â”‚  â”‚ _play_audio_queue()                 â”‚ â”‚
                   â”‚  â”‚ pygame æ’­æ”¾éŸ³é¢‘                     â”‚ â”‚
                   â”‚  â”‚ å‘å°„ tts_started ä¿¡å·               â”‚ â”‚
                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                   â”‚                  â”‚                       â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼ (æ’­æ”¾å®Œæˆ)
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ å‘å°„ tts_finished ä¿¡å·  â”‚
                              â”‚ â†’ _on_tts_finished()    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                                    (è§æµç¨‹7)
```

---

## 7. TTSå®Œæˆåçš„å¤„ç†æµç¨‹

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  _on_tts_finished()     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ pending_speaker_embeddingâ”‚
                              â”‚ is not None?            â”‚
                              â”‚ AND                     â”‚
                              â”‚ waiting_for_speaker_nameâ”‚
                              â”‚ == False?               â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ Yes                   â”‚ No
                              â–¼                       â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ è¿½é—®è¯´è¯äººåå­—   â”‚     â”‚ _reset_button() â”‚
                    â”‚                 â”‚     â”‚ é‡ç½®æŒ‰é’®çŠ¶æ€     â”‚
                    â”‚ waiting_for_    â”‚     â”‚ ç­‰å¾…ä¸‹æ¬¡äº¤äº’     â”‚
                    â”‚ speaker_name    â”‚     â”‚                 â”‚
                    â”‚ = True          â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                 â”‚
                    â”‚ _speak_text()   â”‚
                    â”‚ "å¯¹äº†ï¼Œæˆ‘è¿˜ä¸çŸ¥é“â”‚
                    â”‚ ä½ çš„åå­—ï¼Œè¯·é—®  â”‚
                    â”‚ æ€ä¹ˆç§°å‘¼ä½ ï¼Ÿ"   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ç­‰å¾…ç”¨æˆ·è¯­éŸ³   â”‚
                    â”‚  (å›åˆ°æµç¨‹2)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ _on_asr_finished ä¸­æ£€æµ‹åˆ°   â”‚
                    â”‚ waiting_for_speaker_name    â”‚
                    â”‚ == True                     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ _complete_speaker_registrationâ”‚
                    â”‚ 1. æå–åå­—                   â”‚
                    â”‚ 2. æ³¨å†Œå£°çº¹                   â”‚
                    â”‚ 3. _speak_text()             â”‚
                    â”‚    "å¥½çš„ï¼Œ{åå­—}ï¼Œæˆ‘è®°ä½ä½ äº†" â”‚
                    â”‚ 4. é‡ç½®çŠ¶æ€                   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ä¿¡å·ä¸æ§½è¿æ¥å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          WorkerSignals                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     ASR ä¿¡å·          â”‚        â”‚           å¯¹åº”æ§½å‡½æ•°                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ asr_text_update(str) â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_asr_text_update() å®æ—¶æ›´æ–°è¯†åˆ«æ–‡æœ¬ â”‚   â”‚
â”‚  â”‚ asr_finished(str)    â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_asr_finished() è¯†åˆ«å®Œæˆå¤„ç†        â”‚   â”‚
â”‚  â”‚ asr_audio_data(bytes)â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_asr_audio_data() å£°çº¹è¯†åˆ«å¤„ç†      â”‚   â”‚
â”‚  â”‚ asr_error(str)       â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_asr_error() é”™è¯¯å¤„ç†               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    å½•éŸ³çŠ¶æ€ä¿¡å·        â”‚        â”‚           å¯¹åº”æ§½å‡½æ•°                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ recording_started()  â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_recording_started() å½•éŸ³å¼€å§‹      â”‚   â”‚
â”‚  â”‚ recording_stopped()  â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_recording_stopped() å½•éŸ³åœæ­¢      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     Chat ä¿¡å·         â”‚        â”‚           å¯¹åº”æ§½å‡½æ•°                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ chat_thinking()      â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_chat_thinking() å¯åŠ¨æµå¼TTS       â”‚   â”‚
â”‚  â”‚ chat_chunk(str)      â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_chat_chunk() æµå¼æ–‡æœ¬ç‰‡æ®µå¤„ç†     â”‚   â”‚
â”‚  â”‚ chat_reply(str)      â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_chat_reply() å®Œæ•´å›å¤å¤„ç†         â”‚   â”‚
â”‚  â”‚ chat_error(str)      â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_chat_error() é”™è¯¯å¤„ç†             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     TTS ä¿¡å·          â”‚        â”‚           å¯¹åº”æ§½å‡½æ•°                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ tts_started()        â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_tts_started() å¼€å§‹æ’­æ”¾            â”‚   â”‚
â”‚  â”‚ tts_finished()       â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_tts_finished() æ’­æ”¾å®Œæˆ           â”‚   â”‚
â”‚  â”‚ tts_error(str)       â”‚ â”€â”€â”€â”€â–¶ â”‚ _on_tts_error() é”™è¯¯å¤„ç†              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. çŠ¶æ€å˜é‡ä¸€è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VoiceAssistantWindow çŠ¶æ€å˜é‡                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ åŸºç¡€çŠ¶æ€                                                                â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ is_recording: bool          # æ˜¯å¦æ­£åœ¨å½•éŸ³                              â”‚â”‚
â”‚  â”‚ is_tts_playing: bool        # TTS æ˜¯å¦æ­£åœ¨æ’­æ”¾                          â”‚â”‚
â”‚  â”‚ current_asr_text: str       # å½“å‰è¯†åˆ«çš„æ–‡æœ¬                            â”‚â”‚
â”‚  â”‚ current_ai_text: str        # AI å›å¤æ–‡æœ¬ï¼ˆæµå¼ç´¯ç§¯ï¼‰                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ å›¾åƒç›¸å…³                                                                â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ current_image_path: str     # å½“å‰æ‹æ‘„çš„å›¾ç‰‡è·¯å¾„                         â”‚â”‚
â”‚  â”‚ current_image_base64: str   # å½“å‰å›¾ç‰‡çš„ Base64 ç¼–ç                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ äººè„¸æ³¨å†ŒçŠ¶æ€ï¼ˆè¿½é—®æ¨¡å¼ï¼‰                                                 â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ waiting_for_face_name: bool    # æ˜¯å¦åœ¨ç­‰å¾…ç”¨æˆ·è¯´äººå                    â”‚â”‚
â”‚  â”‚ pending_face_encoding: ndarray # å¾…æ³¨å†Œçš„äººè„¸ç¼–ç                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ å£°çº¹è¯†åˆ«çŠ¶æ€                                                            â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ current_speaker_name: str      # å½“å‰è¯†åˆ«çš„è¯´è¯äºº                        â”‚â”‚
â”‚  â”‚ pending_speaker_embedding: ndarray # å¾…æ³¨å†Œçš„å£°çº¹åµŒå…¥å‘é‡                â”‚â”‚
â”‚  â”‚ waiting_for_speaker_name: bool # æ˜¯å¦åœ¨ç­‰å¾…ç”¨æˆ·è¯´åå­—                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ è®¡æ—¶ç»Ÿè®¡                                                                â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ time_asr_end: float         # è¯­éŸ³è¯†åˆ«å®Œæˆæ—¶é—´                          â”‚â”‚
â”‚  â”‚ time_chat_first: float      # Chat ç¬¬ä¸€ä¸ª chunk åˆ°è¾¾æ—¶é—´                â”‚â”‚
â”‚  â”‚ time_tts_first_synth: float # TTS ç¬¬ä¸€ä¸ªç‰‡æ®µåˆæˆå®Œæˆæ—¶é—´                 â”‚â”‚
â”‚  â”‚ time_tts_play_start: float  # TTS å¼€å§‹æ’­æ”¾æ—¶é—´                          â”‚â”‚
â”‚  â”‚ time_voice_extract: float   # å£°çº¹æå–è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰                       â”‚â”‚
â”‚  â”‚ time_voice_match: float     # å£°çº¹åŒ¹é…è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰                       â”‚â”‚
â”‚  â”‚ time_camera: float          # æ‘„åƒå¤´æ‹ç…§è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰                     â”‚â”‚
â”‚  â”‚ time_face_detect: float     # äººè„¸æ£€æµ‹/è¯†åˆ«è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰                  â”‚â”‚
â”‚  â”‚ time_object_detect: float   # ç‰©ä½“æ£€æµ‹è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰                       â”‚â”‚
â”‚  â”‚ is_first_chunk: bool        # æ˜¯å¦ç¬¬ä¸€ä¸ª chunk                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. å®Œæ•´å¯¹è¯æµç¨‹æ—¶åºå›¾

```
ç”¨æˆ·        éº¦å…‹é£æŒ‰é’®     ASRWorker    SpeakerMgr    IntentHandler    ChatWorker    TTSWorker
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚             â”‚
 â”‚   ç‚¹å‡»       â”‚              â”‚            â”‚              â”‚              â”‚             â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚            â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚   å¯åŠ¨       â”‚            â”‚              â”‚              â”‚             â”‚
 â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚            â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚             â”‚
 â”‚   è¯´è¯ ~~~~~~~~~~~~~~~~~~~~~~â–¶ å½•éŸ³      â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚   â†“        â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚ WebSocket  â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚ ASR API    â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚   â†“        â”‚              â”‚              â”‚             â”‚
 â”‚   é™éŸ³1.5s   â”‚              â”‚ è¯†åˆ«å®Œæˆ   â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚ éŸ³é¢‘æ•°æ®   â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚            â”‚  æå–å£°çº¹    â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚            â”‚  åŒ¹é…è¯´è¯äºº  â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚            â”‚              â”‚  æ„å›¾åˆ¤æ–­    â”‚             â”‚
 â”‚              â”‚              â”‚            â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚  æµå¼è¯·æ±‚   â”‚
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚  Chat API   â”‚
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚      â†“      â”‚
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚  æµå¼å“åº”â”€â”€â”€â–¶â”‚
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚             â”‚ TTS API
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚             â”‚   â†“
 â”‚ â—€~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~â”‚ æ’­æ”¾éŸ³é¢‘   â”‚
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚             â”‚   â†“
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚             â”‚ æ’­æ”¾å®Œæˆ
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚             â”‚   â†“
 â”‚              â”‚              â”‚            â”‚ æ£€æŸ¥å¾…æ³¨å†Œå£°çº¹â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚            â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚             â”‚
 â”‚   (å¦‚æœæ˜¯æ–°ç”¨æˆ·ï¼Œè¿½é—®åå­—)   â”‚            â”‚              â”‚              â”‚             â”‚
 â”‚ â—€~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~â”‚              â”‚              â”‚             â”‚
 â”‚   è¯´åå­— ~~~~~~~~~~~~~~~~~~~~â–¶â”‚           â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚            â”‚  æ³¨å†Œå£°çº¹    â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚            â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚             â”‚
 â”‚ â—€~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~â”‚ "æˆ‘è®°ä½ä½ äº†" â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚            â”‚              â”‚              â”‚             â”‚
```

---

## æ–‡ä»¶è¯´æ˜

æœ¬æµç¨‹å›¾æè¿°äº† `voice_assistant.py` çš„å®Œæ•´ç¨‹åºç»“æ„ï¼ŒåŒ…æ‹¬ï¼š

1. **æ•´ä½“æ¶æ„** - å„ç»„ä»¶å…³ç³»
2. **ä¸»äº¤äº’æµç¨‹** - ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åçš„åˆ†æ”¯
3. **è¯­éŸ³è¯†åˆ«æµç¨‹** - ASRWorker çš„å·¥ä½œè¿‡ç¨‹
4. **è¯†åˆ«å®Œæˆå¤„ç†** - å£°çº¹è¯†åˆ«å’Œæ„å›¾åˆ¤æ–­
5. **æ„å›¾å¤„ç†åˆ†æ”¯** - äº”ç§æ„å›¾çš„å¤„ç†æ–¹å¼
6. **Chatä¸TTSæµç¨‹** - å¯¹è¯å’Œè¯­éŸ³åˆæˆ
7. **TTSå®Œæˆå¤„ç†** - è¿½é—®é€»è¾‘
8. **ä¿¡å·æ§½å…³ç³»** - Qt ä¿¡å·é€šä¿¡
9. **çŠ¶æ€å˜é‡** - å…³é”®çŠ¶æ€ä¸€è§ˆ
10. **å®Œæ•´æ—¶åºå›¾** - ç«¯åˆ°ç«¯æµç¨‹

---

## 11. IntentHandler æ„å›¾ç±»å‹è¯¦è§£

### æ„å›¾ç±»å‹æšä¸¾ (IntentType)

| æšä¸¾å€¼ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|-------|------|-------|
| `SPEAKER_IDENTIFY_OTHER` | å£°çº¹è¯†åˆ«ä»–äººæ„å›¾ï¼ˆä¸¤è½®å¯¹è¯ï¼‰ | 1 (æœ€é«˜) |
| `SPEAKER_IDENTIFY` | å£°çº¹è¯†åˆ«æ„å›¾ï¼ˆè¯†åˆ«å½“å‰è¯´è¯äººï¼‰ | 2 |
| `LOOK` | çœ‹ç›¸å…³æ„å›¾ï¼ˆéœ€è¦æ‹ç…§ï¼‰ | 3 |
| `DEFAULT` | é»˜è®¤æ„å›¾ï¼ˆçº¯æ–‡æœ¬å¯¹è¯ï¼‰ | 4 (æœ€ä½) |

### IntentResult æ•°æ®ç»“æ„

```python
@dataclass
class IntentResult:
    intent_type: IntentType              # æ„å›¾ç±»å‹
    matched_keyword: Optional[str]       # åŒ¹é…åˆ°çš„å…³é”®è¯
    image_path: Optional[str]            # æ‹æ‘„çš„å›¾ç‰‡è·¯å¾„
    original_text: str                   # åŸå§‹è¯†åˆ«æ–‡æœ¬
    error_message: Optional[str]         # é”™è¯¯ä¿¡æ¯

    # äººè„¸è¯†åˆ«ç›¸å…³
    face_results: Optional[List[Dict]]   # äººè„¸è¯†åˆ«ç»“æœåˆ—è¡¨
    pending_face_encoding: Optional[Any] # å¾…æ³¨å†Œçš„äººè„¸ç¼–ç 

    # ç‰©ä½“æ£€æµ‹ç›¸å…³
    object_results: Optional[List[Dict]] # ç‰©ä½“æ£€æµ‹ç»“æœåˆ—è¡¨

    # å£°çº¹è¯†åˆ«ç›¸å…³
    speaker_name: Optional[str]          # è¯†åˆ«å‡ºçš„è¯´è¯äººåå­—
    speaker_similarity: float            # å£°çº¹ç›¸ä¼¼åº¦
    pending_speaker_embedding: Optional[Any]  # å¾…æ³¨å†Œçš„å£°çº¹åµŒå…¥å‘é‡
    waiting_for_other_speaker: bool      # æ˜¯å¦åœ¨ç­‰å¾…ä»–äººè¯´è¯ï¼ˆä¸¤è½®å¯¹è¯æ¨¡å¼ï¼‰

    # è€—æ—¶ç»Ÿè®¡ï¼ˆæ¯«ç§’ï¼‰
    time_camera: float                   # æ‹ç…§è€—æ—¶
    time_face_detect: float              # äººè„¸æ£€æµ‹/è¯†åˆ«è€—æ—¶
    time_object_detect: float            # ç‰©ä½“æ£€æµ‹è€—æ—¶
    time_speaker_identify: float         # å£°çº¹è¯†åˆ«è€—æ—¶
```

### æµ‹è¯•ç”¨å…³é”®è¯

ä¸ºäº†æ–¹ä¾¿æµ‹è¯•éªŒè¯ï¼Œä»¥ä¸‹å…³é”®è¯å¯ç›´æ¥è§¦å‘å¯¹åº”æ„å›¾ï¼š

- **å£°çº¹è¯†åˆ«ï¼ˆè‡ªå·±ï¼‰**: "è¯†åˆ«å£°çº¹"ã€"æµ‹è¯•å£°çº¹è¯†åˆ«"ã€"å£°çº¹è¯†åˆ«"
- **å£°çº¹è¯†åˆ«ï¼ˆä»–äººï¼‰**: "å¬å¬ä»–æ˜¯è°"ã€"å¬å¬å¥¹æ˜¯è°"ã€"è®©ä»–è¯´å‡ å¥"

### ä¸¤è½®å¯¹è¯æµç¨‹ï¼ˆå£°çº¹è¯†åˆ«ä»–äººï¼‰

```
ç”¨æˆ·: "å¬å¬ä»–æ˜¯è°"
  â†“
ç³»ç»Ÿ: "å¥½çš„ï¼Œè¯·è®©ä»–è¯´å‡ å¥è¯"  (è®¾ç½® waiting_for_other_speaker=True)
  â†“
ä»–äºº: [è¯´è¯...]
  â†“
ç³»ç»Ÿ: å¯¹éŸ³é¢‘è¿›è¡Œå£°çº¹è¯†åˆ«
  â†“
ç³»ç»Ÿ: "è¿™æ˜¯å¼ ä¸‰" æˆ– "æˆ‘ä¸è®¤è¯†è¿™ä¸ªäºº"
```
